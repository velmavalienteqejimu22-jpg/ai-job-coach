# Prompt 调整位置定位指南

本文档列出所有需要调整 prompt 的位置，方便快速定位和修改。

---

## 📍 主要 Prompt 位置

### 1. **聊天 API - `/api/chat/route.ts`**

**文件路径：** `app/api/chat/route.ts`

**位置：** 第 23-47 行

**代码片段：**
```typescript
// 构建系统提示词
const systemPrompt = `你是深谙中国就业市场的资深职业顾问，尤其熟悉头部科技企业与国有企业领域。
需具备同理心强、沟通温和、专业度高、逻辑清晰的特质。
请严格按以下步骤引导用户求职，每步衔接需自然：
1. 职业规划指导
2. 经历与技能梳理提炼
3. 作品集指导
4. 简历优化
5. 投递策略指导
6. 了解用户投递细节与岗位描述
7. 结合经历与岗位描述模拟面试
8. 用户在真实面试（多轮）后带领复盘
9. 获offer后协助选择与薪资谈判

引导时需满足：
- 多提细节问题，收集充足信息以提供帮助
- 语气鼓励引导，适配用户语气与效率偏好
- 输出简洁（理想50字内），需深度分析时除外
- 信息充足或用户提示时自动进入下一步
- 避免重复内容，肯定与引导语需多样
- 遇不了解的内容如实说明，向用户索要补充信息
- 必要时将话题拉回求职相关

${userState?.currentStage ? `当前阶段：${userState.currentStage}` : ""}
${userState?.identity ? `用户身份：${userState.identity}` : ""}`;
```

**用途：** 控制聊天对话的主要 AI 角色和行为

**调整建议：**
- 修改角色定位（第 24 行）
- 调整引导步骤（第 26-35 行）
- 修改引导规则（第 37-44 行）

---

### 2. **分析 API - `/api/analyze/route.ts`**

**文件路径：** `app/api/analyze/route.ts`

**位置：** 第 33-55 行（用户提示词）和第 60 行（系统提示词）

**代码片段 1 - 用户提示词：**
```typescript
// 构建分析提示词
const analysisPrompt = `你是一个专业的求职对话分析助手。请分析以下对话内容，提取关键信息并返回 JSON 格式。

要求：
1. 判断当前求职阶段（career/project/resume/apply/interview/offer）
2. 评估进度（0-1之间的浮点数）
3. 提取意向岗位（如果有，返回字符串，否则返回 null）
4. 提取核心技能（数组，如果没有返回空数组）
5. 提取项目经历（数组，包含 title, depth, description，如果没有返回空数组）
6. 提取简历摘要（如果有，返回字符串，否则返回 null）

对话内容：
${recentMessages.map((msg, i) => `${msg.role || (msg.isUser ? "user" : "assistant")}: ${msg.content}`).join("\n")}

请严格按照以下 JSON 格式返回，不要包含任何其他文字或 markdown 代码块标记：
{
  "stage": "阶段名称",
  "progress": 0.0-1.0,
  "intent_text": "意向岗位或null",
  "skills": ["技能1", "技能2"],
  "projects": [{"title": "项目名", "depth": 1, "description": "描述"}],
  "resumeSummary": "摘要或null"
}`;
```

**代码片段 2 - 系统提示词：**
```typescript
{ role: "system", content: "你是一个专业的 JSON 数据提取助手，只返回有效的 JSON 格式，不包含任何其他文字。" },
```

**用途：** 控制对话分析的数据提取逻辑

**调整建议：**
- 修改分析要求（第 36-42 行）
- 调整 JSON 格式定义（第 47-55 行）
- 修改系统提示词（第 60 行）

---

### 3. **面试 API - `/api/interview/route.ts`**

**文件路径：** `app/api/interview/route.ts`

**位置：** 第 68-69 行

**代码片段：**
```typescript
const systemPrompt =
  "你是一位理性的 AI 面试官，请针对产品经理岗位进行结构化面试。每次只问一个问题。结尾生成总结反馈（优点+改进方向）。";
```

**用途：** 控制面试官的角色和行为

**调整建议：**
- 修改面试官角色定位
- 调整面试策略
- 修改反馈格式要求

---

### 4. **简历优化 API - `/api/resume-optimize/route.ts`**

**文件路径：** `app/api/resume-optimize/route.ts`

**位置：** 第 51-52 行

**代码片段：**
```typescript
const systemPrompt = "你是一名资深简历优化顾问，请基于用户简历内容，生成 3 点具体优化建议（突出结果导向、量化成果、关键词匹配）。输出应清晰简洁。";
const userPrompt = `以下是用户的简历文本，请基于其内容给出恰当的优化建议（严格 3 点，使用条目列表）：\n\n${input}`;
```

**用途：** 控制简历优化的建议生成

**调整建议：**
- 修改优化顾问的角色定位
- 调整建议格式要求
- 修改建议数量或结构

---

### 5. **Demo Chat API - `/api/demo-chat/route.ts`**（可选）

**文件路径：** `app/api/demo-chat/route.ts`

**位置：** 第 45-77 行（`buildSystemPromptWithOnboarding` 函数）

**代码片段：**
```typescript
function buildSystemPromptWithOnboarding(onboarding?: Collected["onboarding"], currentStage?: string) {
  const basePrompt = "你是深谙中国就业市场的资深职业顾问，尤其熟悉头部科技企业与国有企业领域。需具备同理心强、沟通温和、专业度高、逻辑清晰的特质。请严格按以下步骤引导用户求职，每步衔接需自然：1. 职业规划指导2. 经历与技能梳理提炼3. 作品集指导4. 简历优化5. 投递策略指导6. 了解用户投递细节与岗位描述7. 结合经历与岗位描述模拟面试8. 用户在真实面试（多轮）后带领复盘9. 获offer后协助选择与薪资谈判引导时需满足：- 多提细节问题，收集充足信息以提供帮助- 语气鼓励引导，适配用户语气与效率偏好- 输出简洁（理想50字内），需深度分析时除外- 信息充足或用户提示时自动进入下一步- 避免重复内容，肯定与引导语需多样- 遇不了解的内容如实说明，向用户索要补充信息- 必要时将话题拉回求职相关请从职业规划指导切入，询问用户职业方向、兴趣点与目标。";
  // ... 其他逻辑
}
```

**用途：** 动态构建系统提示词（基于用户 onboarding 信息）

**调整建议：**
- 修改基础提示词（第 60 行）
- 调整阶段指令（第 46-58 行）
- 修改上下文信息构建逻辑（第 64-76 行）

---

## 🎯 快速定位表

| API 路由 | 文件路径 | Prompt 位置 | 主要用途 |
|---------|---------|------------|---------|
| `/api/chat` | `app/api/chat/route.ts` | 第 23-47 行 | 聊天对话主提示词 |
| `/api/analyze` | `app/api/analyze/route.ts` | 第 33-55 行（用户）<br>第 60 行（系统） | 对话分析提示词 |
| `/api/interview` | `app/api/interview/route.ts` | 第 68-69 行 | 面试官提示词 |
| `/api/resume-optimize` | `app/api/resume-optimize/route.ts` | 第 51-52 行 | 简历优化提示词 |
| `/api/demo-chat` | `app/api/demo-chat/route.ts` | 第 45-77 行 | 动态提示词构建 |

---

## 🔧 调整建议

### 1. **聊天提示词调整**（最常用）

**文件：** `app/api/chat/route.ts`

**需要调整的场景：**
- 修改 AI 角色定位
- 调整引导流程
- 修改回复风格
- 添加新的引导规则

**示例调整：**
```typescript
// 修改角色定位
const systemPrompt = `你是[新的角色定位]...`;

// 添加新的引导规则
引导时需满足：
- [现有规则]
- [新增规则]
```

### 2. **分析提示词调整**

**文件：** `app/api/analyze/route.ts`

**需要调整的场景：**
- 修改提取的数据字段
- 调整 JSON 格式
- 修改分析逻辑要求

**示例调整：**
```typescript
// 添加新的提取字段
要求：
1. [现有要求]
2. [新增要求：提取新的字段]
```

### 3. **面试提示词调整**

**文件：** `app/api/interview/route.ts`

**需要调整的场景：**
- 修改面试官风格
- 调整面试岗位
- 修改反馈格式

---

## 📝 注意事项

1. **保持格式一致：** 修改 prompt 时注意保持原有的格式和结构
2. **测试验证：** 修改后需要测试 API 响应是否符合预期
3. **JSON 格式：** 分析 API 的 prompt 必须确保返回有效的 JSON
4. **变量插值：** 注意 `${userState?.currentStage}` 等变量的使用
5. **多语言支持：** 如果支持多语言，注意 prompt 的语言设置

---

## 🚀 快速修改流程

1. **定位文件：** 根据上表找到对应的文件路径
2. **找到位置：** 使用行号定位到具体的 prompt 代码
3. **修改内容：** 根据需求调整 prompt 文本
4. **保存文件：** 保存修改
5. **重启服务：** 重启开发服务器使修改生效
6. **测试验证：** 测试 API 响应是否符合预期

---

## 📚 相关文档

- `lib/integration_notes.md` - API 集成说明
- `lib/animation_changes.md` - 动画改动说明

